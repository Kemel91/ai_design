<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞ - –ê–º—É–ª–µ—Ç –¥—Ä–∞–∫–æ–Ω–∞</title>
    <meta name="description" content="–¢–µ–∫—Å—Ç–æ–≤–∞—è MMORPG - –ê–º—É–ª–µ—Ç –¥—Ä–∞–∫–æ–Ω–∞. –ò–≥—Ä–∞–π—Ç–µ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ!">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="scripts.js" as="script">
    <link rel="preload" href="components.js" as="script">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dragon: {
                            50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8',
                            400: '#a1a1aa', 500: '#71717a', 600: '#52525b', 700: '#3f3f46',
                            800: '#27272a', 900: '#18181b',
                        },
                        blood: {
                            50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5',
                            400: '#f87171', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c',
                            800: '#991b1b', 900: '#7f1d1d',
                        },
                        gold: {
                            50: '#fffbeb', 100: '#fef3c7', 200: '#fde68a', 300: '#fcd34d',
                            400: '#fbbf24', 500: '#f59e0b', 600: '#d97706', 700: '#b45309',
                            800: '#92400e', 900: '#78350f',
                        }
                    },
                    fontFamily: { 'medieval': ['serif'] },
                    screens: { 'xs': '475px' }
                }
            }
        }
    </script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        .mobile-game-container {
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height for mobile */
            display: flex;
            flex-direction: column;
        }
        
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 80px; /* Space for bottom nav */
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(145deg, rgba(20, 20, 25, 0.98), rgba(10, 10, 15, 0.95));
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(245, 158, 11, 0.3);
            z-index: 30;
        }
        
        .nav-tab {
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .nav-tab.active {
            background: linear-gradient(45deg, rgba(127, 29, 29, 0.3), rgba(185, 28, 28, 0.2));
            border-top: 2px solid #d97706;
        }
        
        .health-bar {
            background: linear-gradient(90deg, #dc2626 0%, #ef4444 50%, #f87171 100%);
        }
        
        .mana-bar {
            background: linear-gradient(90deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
        }
        
        .exp-bar {
            background: linear-gradient(90deg, #059669 0%, #10b981 50%, #34d399 100%);
        }
        
        .entity-card {
            transition: all 0.3s ease;
            min-height: 60px;
        }
        
        .entity-card:active {
            transform: scale(0.98);
            background: linear-gradient(145deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05));
        }
        
        .action-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(145deg, rgba(20, 20, 25, 0.98), rgba(10, 10, 15, 0.95));
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(245, 158, 11, 0.3);
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 40;
            max-height: 50vh;
            overflow-y: auto;
        }
        
        .action-sheet.show {
            transform: translateY(0);
        }
        
        .action-sheet-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 35;
            display: none;
        }
        
        .action-sheet-overlay.show {
            display: block;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .swipe-indicator {
            width: 40px;
            height: 4px;
            background: rgba(245, 158, 11, 0.3);
            border-radius: 2px;
            margin: 8px auto;
        }
        
        .location-journal {
            background: linear-gradient(145deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05));
            border-left: 4px solid #d97706;
        }
    </style>
</head>
<body class="dragon-bg text-white" style="background-color: #0a0a0a !important;">
    
    <!-- Mobile Game Container -->
    <div class="mobile-game-container">
        
        <!-- Top Status Bar -->
        <div class="dragon-card rounded-b-2xl p-3 mx-2 mt-2">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-gold-500 to-gold-700 rounded-full flex items-center justify-center text-lg font-bold mr-3">
                        ‚öî
                    </div>
                    <div>
                        <h1 class="font-medieval font-bold text-gold-400 text-sm" id="playerName">–ö—Ä–æ–≤–∞–≤—ã–π–ö–ª–∏–Ω–æ–∫</h1>
                        <p class="text-xs text-dragon-300">–£—Ä.<span id="playerLevel">15</span> –í–æ–∏–Ω</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-gold-400 font-semibold text-sm" id="playerGold">1,250</div>
                    <div class="text-xs text-dragon-400">üí∞</div>
                </div>
            </div>
            
            <!-- Health & Mana Bars -->
            <div class="space-y-1">
                <div class="flex justify-between text-xs">
                    <span class="text-red-400">‚ù§</span>
                    <span id="healthText">85/100</span>
                </div>
                <div class="w-full bg-dragon-800 rounded-full h-2">
                    <div class="health-bar h-2 rounded-full" style="width: 85%" id="healthBar"></div>
                </div>
                
                <div class="flex justify-between text-xs">
                    <span class="text-blue-400">üîÆ</span>
                    <span id="manaText">45/60</span>
                </div>
                <div class="w-full bg-dragon-800 rounded-full h-2">
                    <div class="mana-bar h-2 rounded-full" style="width: 75%" id="manaBar"></div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content px-2">
            
            <!-- Location Info -->
            <div class="dragon-card rounded-xl p-4 mt-2">
                <h2 class="font-medieval text-lg font-bold text-gold-400 mb-2 flex items-center">
                    üç∫ –¢–∞–≤–µ—Ä–Ω–∞ "–ü—å—è–Ω—ã–π –î—Ä–∞–∫–æ–Ω"
                </h2>
                
                <!-- Location Journal (Priority) -->
                <div class="location-journal rounded-lg p-3 mb-3">
                    <h3 class="font-medieval font-semibold text-gold-400 mb-2 text-xs flex items-center">
                        üìã –°–æ–±—ã—Ç–∏—è
                    </h3>
                    <div class="space-y-1 max-h-20 overflow-y-auto text-xs" id="locationJournal">
                        <div class="text-gold-300">üç∫ –í—ã –≤—Ö–æ–¥–∏—Ç–µ –≤ —Ç–∞–≤–µ—Ä–Ω—É "–ü—å—è–Ω—ã–π –î—Ä–∞–∫–æ–Ω"</div>
                        <div class="text-dragon-300">üî• –ö–∞–º–∏–Ω –ø–æ—Ç—Ä–µ—Å–∫–∏–≤–∞–µ—Ç, —Ä–∞–∑–±—Ä–∞—Å—ã–≤–∞—è –∏—Å–∫—Ä—ã</div>
                        <div class="text-dragon-300">üéµ –ë–∞—Ä–º–µ–Ω –Ω–∞–ø–µ–≤–∞–µ—Ç –≤–µ—Å–µ–ª—É—é –ø–µ—Å–Ω—é</div>
                    </div>
                </div>
                
                <!-- Location Exits -->
                <div class="flex gap-2 overflow-x-auto">
                    <button class="location-exit btn-secondary px-3 py-2 rounded-lg font-medieval text-xs whitespace-nowrap" onclick="goToLocation('square')">
                        üèõ –ü–ª–æ—â–∞–¥—å
                    </button>
                    <button class="location-exit btn-secondary px-3 py-2 rounded-lg font-medieval text-xs whitespace-nowrap" onclick="goToLocation('rooms')">
                        üõè –ö–æ–º–Ω–∞—Ç—ã
                    </button>
                    <button class="location-exit btn-secondary px-3 py-2 rounded-lg font-medieval text-xs whitespace-nowrap" onclick="goToLocation('cellar')">
                        üï≥ –ü–æ–¥–≤–∞–ª
                    </button>
                </div>
            </div>
            
            <!-- Tab Content -->
            <div class="mt-2">
                
                <!-- Entities Tab -->
                <div id="entitiesTab" class="tab-content active">
                    <div class="dragon-card rounded-xl p-4">
                        <h3 class="font-medieval font-semibold text-gold-400 mb-3 text-sm">üëÅ –í –ª–æ–∫–∞—Ü–∏–∏</h3>
                        <div class="space-y-2" id="locationEntities">
                            
                            <!-- NPCs -->
                            <div class="entity-card p-3 rounded-lg border-l-4 border-gold-500 cursor-pointer" onclick="showActionSheet('npc', 'barman')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="text-xl mr-3">üßî</span>
                                        <div>
                                            <span class="font-medieval font-semibold text-gold-400 text-sm">–ë–∞—Ä–º–µ–Ω –¢–æ—Ä–≤–∞–ª—å–¥</span>
                                            <p class="text-xs text-dragon-300">–ü–æ–ª—É—Ä–æ—Å–ª–∏–∫-—Ç—Ä–∞–∫—Ç–∏—Ä—â–∏–∫</p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-gold-500">NPC</span>
                                </div>
                            </div>
                            
                            <!-- Players -->
                            <div class="entity-card p-3 rounded-lg border-l-4 border-green-500 cursor-pointer" onclick="showActionSheet('player', 'shadowkiller')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="text-xl mr-3">üó°</span>
                                        <div>
                                            <span class="font-medieval font-semibold text-green-400 text-sm">–¢–µ–Ω–µ–≤–æ–π–£–±–∏–π—Ü–∞</span>
                                            <p class="text-xs text-dragon-300">–£—Ä.23 –†–∞–∑–±–æ–π–Ω–∏–∫</p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-green-500">–ò–≥—Ä–æ–∫</span>
                                </div>
                            </div>
                            
                            <div class="entity-card p-3 rounded-lg border-l-4 border-green-500 cursor-pointer" onclick="showActionSheet('player', 'firevalkyrie')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="text-xl mr-3">üî•</span>
                                        <div>
                                            <span class="font-medieval font-semibold text-green-400 text-sm">–û–≥–Ω–µ–Ω–Ω–∞—è–í–∞–ª—å–∫–∏—Ä–∏—è</span>
                                            <p class="text-xs text-dragon-300">–£—Ä.18 –ú–∞–≥</p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-green-500">–ò–≥—Ä–æ–∫</span>
                                </div>
                            </div>
                            
                            <!-- Enemies -->
                            <div class="entity-card p-3 rounded-lg border-l-4 border-red-500 cursor-pointer" onclick="showActionSheet('enemy', 'rat1')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="text-xl mr-3">üêÄ</span>
                                        <div>
                                            <span class="font-medieval font-semibold text-red-400 text-sm">–ù–∞–≥–ª–∞—è –∫—Ä—ã—Å–∞</span>
                                            <p class="text-xs text-dragon-300">–£—Ä.2, –≥—Ä—ã–∑–µ—Ç –∫–æ—Å—Ç—å</p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-red-500">–í—Ä–∞–≥</span>
                                </div>
                            </div>
                            
                            <div class="entity-card p-3 rounded-lg border-l-4 border-red-500 cursor-pointer" onclick="showActionSheet('enemy', 'rat2')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="text-xl mr-3">üêÄ</span>
                                        <div>
                                            <span class="font-medieval font-semibold text-red-400 text-sm">–ñ–∏—Ä–Ω–∞—è –∫—Ä—ã—Å–∞</span>
                                            <p class="text-xs text-dragon-300">–£—Ä.3, —à–∞—Ä–∏—Ç—Å—è –ø–æ —É–≥–ª–∞–º</p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-red-500">–í—Ä–∞–≥</span>
                                </div>
                            </div>
                            
                            <!-- Items -->
                            <div class="entity-card p-3 rounded-lg border-l-4 border-purple-500 cursor-pointer" onclick="showActionSheet('item', 'coin')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="text-xl mr-3">ü™ô</span>
                                        <div>
                                            <span class="font-medieval font-semibold text-purple-400 text-sm">–ó–æ–ª–æ—Ç–∞—è –º–æ–Ω–µ—Ç–∞</span>
                                            <p class="text-xs text-dragon-300">–ë–ª–µ—Å—Ç–∏—Ç –Ω–∞ –ø–æ–ª—É</p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-purple-500">–ü—Ä–µ–¥–º–µ—Ç</span>
                                </div>
                            </div>
                            
                            <div class="entity-card p-3 rounded-lg border-l-4 border-purple-500 cursor-pointer" onclick="showActionSheet('item', 'dagger')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="text-xl mr-3">üó°</span>
                                        <div>
                                            <span class="font-medieval font-semibold text-purple-400 text-sm">–°—Ç–∞—Ä—ã–π –∫–∏–Ω–∂–∞–ª</span>
                                            <p class="text-xs text-dragon-300">–õ–µ–∂–∏—Ç –≤ —É–≥–ª—É</p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-purple-500">–ü—Ä–µ–¥–º–µ—Ç</span>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <!-- Chat Tab -->
                <div id="chatTab" class="tab-content">
                    <div class="dragon-card rounded-xl p-4">
                        <h3 class="font-medieval font-semibold text-gold-400 mb-3 text-sm">üí¨ –ß–∞—Ç</h3>
                        
                        <!-- Chat Messages -->
                        <div class="space-y-2 mb-4 text-xs max-h-60 overflow-y-auto" id="chatMessages">
                            <div>
                                <span class="text-green-400">[–¢–µ–Ω–µ–≤–æ–π–£–±–∏–π—Ü–∞]:</span>
                                <span class="text-dragon-200">–ö—Ç–æ-–Ω–∏–±—É–¥—å –∑–Ω–∞–µ—Ç, –≥–¥–µ –Ω–∞–π—Ç–∏ –ú–∞—Å—Ç–µ—Ä–∞ –ö–ª–∏–Ω–∫–æ–≤?</span>
                            </div>
                            <div>
                                <span class="text-gold-400">[–ë–∞—Ä–º–µ–Ω –¢–æ—Ä–≤–∞–ª—å–¥]:</span>
                                <span class="text-dragon-200">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–∞–≤–µ—Ä–Ω—É, –ø—É—Ç–Ω–∏–∫!</span>
                            </div>
                            <div>
                                <span class="text-green-400">[–û–≥–Ω–µ–Ω–Ω–∞—è–í–∞–ª—å–∫–∏—Ä–∏—è]:</span>
                                <span class="text-dragon-200">–ò—â—É –≥—Ä—É–ø–ø—É –¥–ª—è –ø–æ—Ö–æ–¥–∞ –≤ –¢–µ–º–Ω—ã–π –ª–µ—Å</span>
                            </div>
                        </div>
                        
                        <!-- Chat Input -->
                        <div class="space-y-2">
                            <div class="flex gap-1 text-xs">
                                <button class="chat-mode px-2 py-1 rounded bg-green-600 text-white" data-mode="say">–°–∫–∞–∑–∞—Ç—å</button>
                                <button class="chat-mode px-2 py-1 rounded bg-dragon-600 text-dragon-200" data-mode="yell">–ö—Ä–∏—á–∞—Ç—å</button>
                                <button class="chat-mode px-2 py-1 rounded bg-dragon-600 text-dragon-200" data-mode="whisper">–®–µ–ø—Ç–∞—Ç—å</button>
                            </div>
                            <div class="flex gap-2">
                                <input 
                                    type="text" 
                                    id="chatInput" 
                                    class="form-input flex-1 px-3 py-2 rounded-lg text-xs" 
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                                    maxlength="200"
                                >
                                <button class="btn-dragon px-3 py-2 rounded-lg text-xs" onclick="sendMessage()">
                                    üì§
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Tab -->
                <div id="statsTab" class="tab-content">
                    <div class="dragon-card rounded-xl p-4">
                        <h3 class="font-medieval font-semibold text-gold-400 mb-3 text-sm">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-xl font-bold text-gold-400">15</div>
                                    <div class="text-xs text-dragon-300">–£—Ä–æ–≤–µ–Ω—å</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xl font-bold text-green-400">2,340</div>
                                    <div class="text-xs text-dragon-300">–û–ø—ã—Ç</div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-xl font-bold text-purple-400">–°—Ç–∞–ª—å–Ω—ã–µ –í–æ–ª–∫–∏</div>
                                    <div class="text-xs text-dragon-300">–ö–ª–∞–Ω</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xl font-bold text-blue-400">1,250</div>
                                    <div class="text-xs text-dragon-300">–ó–æ–ª–æ—Ç–æ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="flex h-full">
                <button class="nav-tab flex-1 flex flex-col items-center justify-center active" onclick="switchTab('entities')">
                    <span class="text-2xl mb-1">üëÅ</span>
                    <span class="text-xs font-medieval">–õ–æ–∫–∞—Ü–∏—è</span>
                </button>
                <button class="nav-tab flex-1 flex flex-col items-center justify-center" onclick="switchTab('chat')">
                    <span class="text-2xl mb-1">üí¨</span>
                    <span class="text-xs font-medieval">–ß–∞—Ç</span>
                </button>
                <button class="nav-tab flex-1 flex flex-col items-center justify-center" onclick="switchTab('stats')">
                    <span class="text-2xl mb-1">üìä</span>
                    <span class="text-xs font-medieval">–°—Ç–∞—Ç—ã</span>
                </button>
                <button class="nav-tab flex-1 flex flex-col items-center justify-center" onclick="window.location.href='character.html'">
                    <span class="text-2xl mb-1">üë§</span>
                    <span class="text-xs font-medieval">–ü–µ—Ä—Å–æ–Ω–∞–∂</span>
                </button>
            </div>
        </div>
        
    </div>
    
    <!-- Action Sheet Overlay -->
    <div id="actionSheetOverlay" class="action-sheet-overlay" onclick="hideActionSheet()"></div>
    
    <!-- Action Sheet -->
    <div id="actionSheet" class="action-sheet">
        <div class="swipe-indicator"></div>
        <div class="p-4">
            <h3 class="font-medieval font-semibold text-gold-400 mb-4 text-center" id="actionSheetTitle">–î–µ–π—Å—Ç–≤–∏—è</h3>
            <div id="actionSheetContent" class="space-y-2"></div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="scripts.js"></script>
    <script src="components.js"></script>
    
    <script>
        // Game state
        let currentTab = 'entities';
        let currentChatMode = 'say';
        let gameData = {
            player: {
                name: '–ö—Ä–æ–≤–∞–≤—ã–π–ö–ª–∏–Ω–æ–∫',
                level: 15,
                health: 85,
                maxHealth: 100,
                mana: 45,
                maxMana: 60,
                exp: 2340,
                maxExp: 3000,
                gold: 1250,
                guild: '–°—Ç–∞–ª—å–Ω—ã–µ –í–æ–ª–∫–∏'
            },
            location: 'tavern'
        };
        
        // Initialize game
        document.addEventListener('DOMContentLoaded', function() {
            updatePlayerStats();
            setupChatModes();
            setupChatInput();
            simulateActivity();
            
            console.log('–ú–æ–±–∏–ª—å–Ω–∞—è –∏–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ - –¢–∞–≤–µ—Ä–Ω–∞ "–ü—å—è–Ω—ã–π –î—Ä–∞–∫–æ–Ω"');
        });
        
        // Update player statistics display
        function updatePlayerStats() {
            const player = gameData.player;
            
            document.getElementById('playerName').textContent = player.name;
            document.getElementById('playerLevel').textContent = player.level;
            document.getElementById('playerGold').textContent = player.gold.toLocaleString();
            
            // Health bar
            const healthPercent = (player.health / player.maxHealth) * 100;
            document.getElementById('healthBar').style.width = healthPercent + '%';
            document.getElementById('healthText').textContent = `${player.health}/${player.maxHealth}`;
            
            // Mana bar
            const manaPercent = (player.mana / player.maxMana) * 100;
            document.getElementById('manaBar').style.width = manaPercent + '%';
            document.getElementById('manaText').textContent = `${player.mana}/${player.maxMana}`;
        }
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.closest('.nav-tab').classList.add('active');
            
            currentTab = tabName;
        }
        
        // Action sheet system
        function showActionSheet(type, id) {
            const overlay = document.getElementById('actionSheetOverlay');
            const sheet = document.getElementById('actionSheet');
            const title = document.getElementById('actionSheetTitle');
            const content = document.getElementById('actionSheetContent');
            
            // Generate content based on type
            let sheetHTML = '';
            let sheetTitle = '';
            
            switch(type) {
                case 'npc':
                    sheetTitle = 'üßî –î–µ–π—Å—Ç–≤–∏—è —Å NPC';
                    sheetHTML = `
                        <button onclick="talkToNPC('${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üí¨ –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å</button>
                        <button onclick="showInfo('${type}', '${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üëÅ –û—Å–º–æ—Ç—Ä–µ—Ç—å</button>
                        <button onclick="tradeWithNPC('${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üõí –¢–æ—Ä–≥–æ–≤–∞—Ç—å</button>
                    `;
                    break;
                    
                case 'player':
                    sheetTitle = 'üë§ –î–µ–π—Å—Ç–≤–∏—è —Å –∏–≥—Ä–æ–∫–æ–º';
                    sheetHTML = `
                        <button onclick="talkToPlayer('${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üí¨ –°–∫–∞–∑–∞—Ç—å</button>
                        <button onclick="showInfo('${type}', '${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üëÅ –û—Å–º–æ—Ç—Ä–µ—Ç—å</button>
                        <button onclick="attackPlayer('${id}')" class="w-full btn-dragon px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">‚öî –ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
                        <button onclick="inviteToGroup('${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üë• –í –≥—Ä—É–ø–ø—É</button>
                    `;
                    break;
                    
                case 'enemy':
                    sheetTitle = 'üêÄ –î–µ–π—Å—Ç–≤–∏—è —Å –≤—Ä–∞–≥–æ–º';
                    sheetHTML = `
                        <button onclick="attackEnemy('${id}')" class="w-full btn-dragon px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">‚öî –ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
                        <button onclick="showInfo('${type}', '${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üëÅ –û—Å–º–æ—Ç—Ä–µ—Ç—å</button>
                        <button onclick="castSpellOn('${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üîÆ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ</button>
                    `;
                    break;
                    
                case 'item':
                    sheetTitle = 'üì¶ –î–µ–π—Å—Ç–≤–∏—è —Å –ø—Ä–µ–¥–º–µ—Ç–æ–º';
                    sheetHTML = `
                        <button onclick="takeItem('${id}')" class="w-full btn-dragon px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üì¶ –í–∑—è—Ç—å</button>
                        <button onclick="showInfo('${type}', '${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">üëÅ –û—Å–º–æ—Ç—Ä–µ—Ç—å</button>
                        <button onclick="useItem('${id}')" class="w-full btn-secondary px-4 py-3 rounded-lg font-medieval text-sm mb-2 min-h-[50px]">‚ú® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                    `;
                    break;
            }
            
            title.textContent = sheetTitle;
            content.innerHTML = sheetHTML;
            
            // Show action sheet
            overlay.classList.add('show');
            sheet.classList.add('show');
        }
        
        function hideActionSheet() {
            const overlay = document.getElementById('actionSheetOverlay');
            const sheet = document.getElementById('actionSheet');
            overlay.classList.remove('show');
            sheet.classList.remove('show');
        }
        
        // Chat system
        function setupChatModes() {
            document.querySelectorAll('.chat-mode').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.chat-mode').forEach(b => {
                        b.classList.remove('bg-green-600', 'text-white');
                        b.classList.add('bg-dragon-600', 'text-dragon-200');
                    });
                    
                    this.classList.remove('bg-dragon-600', 'text-dragon-200');
                    this.classList.add('bg-green-600', 'text-white');
                    
                    currentChatMode = this.dataset.mode;
                });
            });
        }
        
        function setupChatInput() {
            const input = document.getElementById('chatInput');
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }
        
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            let prefix = '';
            switch(currentChatMode) {
                case 'say':
                    prefix = `<span class="text-green-400">[${gameData.player.name}]:</span>`;
                    break;
                case 'yell':
                    prefix = `<span class="text-yellow-400">[${gameData.player.name} –∫—Ä–∏—á–∏—Ç]:</span>`;
                    break;
                case 'whisper':
                    prefix = `<span class="text-blue-400">[${gameData.player.name} —à–µ–ø—á–µ—Ç]:</span>`;
                    break;
            }
            
            messageDiv.innerHTML = `${prefix} <span class="text-dragon-200">${message}</span>`;
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Clear input
            input.value = '';
        }
        
        // Add message to location journal
        function addLocationJournal(message, icon = 'üìã') {
            const journal = document.getElementById('locationJournal');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'text-dragon-300';
            messageDiv.innerHTML = `${icon} ${message}`;
            journal.appendChild(messageDiv);
            
            // Keep only last 5 messages
            while (journal.children.length > 5) {
                journal.removeChild(journal.firstChild);
            }
            
            // Scroll to bottom
            journal.scrollTop = journal.scrollHeight;
        }
        
        // Action handlers
        function talkToNPC(id) {
            hideActionSheet();
            const responses = {
                'barman': '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–æ—é —Ç–∞–≤–µ—Ä–Ω—É! –£ –Ω–∞—Å –ª—É—á—à–∏–π —ç–ª—å –≤ –≥–æ—Ä–æ–¥–µ –∏ –≥–æ—Ä—è—á–∞—è –µ–¥–∞. –ß—Ç–æ –∂–µ–ª–∞–µ—Ç–µ?'
            };
            addLocationJournal('–í—ã –≥–æ–≤–æ—Ä–∏—Ç–µ —Å –±–∞—Ä–º–µ–Ω–æ–º', 'üí¨');
        }
        
        function talkToPlayer(id) {
            hideActionSheet();
            document.getElementById('chatInput').focus();
            switchTab('chat');
        }
        
        function attackPlayer(id) {
            hideActionSheet();
            addLocationJournal(`–ù–∞—á–∞–ª—Å—è PvP –±–æ–π —Å –∏–≥—Ä–æ–∫–æ–º ${id}`, '‚öî');
        }
        
        function attackEnemy(id) {
            hideActionSheet();
            const enemies = {
                'rat1': '–ù–∞–≥–ª—É—é –∫—Ä—ã—Å—É',
                'rat2': '–ñ–∏—Ä–Ω—É—é –∫—Ä—ã—Å—É'
            };
            addLocationJournal(`–í—ã –∞—Ç–∞–∫—É–µ—Ç–µ ${enemies[id]}`, '‚öî');
        }
        
        function takeItem(id) {
            hideActionSheet();
            const items = {
                'coin': '–ó–æ–ª–æ—Ç—É—é –º–æ–Ω–µ—Ç—É (+5 –∑–æ–ª–æ—Ç–∞)',
                'dagger': '–°—Ç–∞—Ä—ã–π –∫–∏–Ω–∂–∞–ª'
            };
            addLocationJournal(`–í—ã –ø–æ–¥–±–∏—Ä–∞–µ—Ç–µ ${items[id]}`, 'üì¶');
            
            // Update gold if coin
            if (id === 'coin') {
                gameData.player.gold += 5;
                updatePlayerStats();
            }
        }
        
        function showInfo(type, id) {
            hideActionSheet();
            // Show info modal or switch to stats tab
            switchTab('stats');
        }
        
        // Quick actions
        function openQuickActions() {
            // Show quick actions sheet
            showActionSheet('quick', 'actions');
        }
        
        // Location navigation
        function goToLocation(locationId) {
            const locations = {
                'square': '–ì–æ—Ä–æ–¥—Å–∫–∞—è –ø–ª–æ—â–∞–¥—å',
                'rooms': '–ö–æ–º–Ω–∞—Ç—ã –¥–ª—è –ø–æ—Å—Ç–æ—è–ª—å—Ü–µ–≤',
                'cellar': '–ü–æ–¥–≤–∞–ª —Ç–∞–≤–µ—Ä–Ω—ã'
            };
            
            addLocationJournal(`–í—ã –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å –≤: ${locations[locationId]}`, 'üö™');
        }
        
        // Simulate game activity
        function simulateActivity() {
            setInterval(() => {
                if (Math.random() < 0.15) {
                    const events = [
                        { message: '–ë–∞—Ä–º–µ–Ω –Ω–∞–ª–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é –ø–æ—Ä—Ü–∏—é —ç–ª—è', icon: 'üç∫' },
                        { message: '–ö—Ä—ã—Å–∞ –ø—Ä–æ–±–µ–≥–∞–µ—Ç –ø–æ–¥ —Å—Ç–æ–ª–æ–º', icon: 'üêÄ' },
                        { message: '–ö–∞–º–∏–Ω –ø–æ—Ç—Ä–µ—Å–∫–∏–≤–∞–µ—Ç, —Ä–∞–∑–±—Ä–∞—Å—ã–≤–∞—è –∏—Å–∫—Ä—ã', icon: 'üî•' },
                        { message: '–ö—Ç–æ-—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Ç–∞–≤–µ—Ä–Ω—É', icon: 'üö™' },
                        { message: '–°–ª—ã—à–µ–Ω —Å–º–µ—Ö –∏–∑ –¥–∞–ª—å–Ω–µ–≥–æ —É–≥–ª–∞', icon: 'üòÑ' }
                    ];
                    const event = events[Math.floor(Math.random() * events.length)];
                    addLocationJournal(event.message, event.icon);
                }
            }, 5000);
        }
    </script>
    
</body>
</html>